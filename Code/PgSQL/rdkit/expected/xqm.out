-- parsing and conversion to text
select mol_to_tautomerquery('Cc1n[nH]c(F)c1'::mol);
                           mol_to_tautomerquery                            
---------------------------------------------------------------------------
 {                                                                        +
     "xqm_type": "3",                                                     +
     "tautomers": [                                                       +
         "Cc1cc(F)[nH]n1",                                                +
         "Cc1cc(F)n[nH]1"                                                 +
     ],                                                                   +
     "modifiedAtoms": [                                                   +
         "2",                                                             +
         "3"                                                              +
     ],                                                                   +
     "modifiedBonds": [                                                   +
         "1",                                                             +
         "3",                                                             +
         "5",                                                             +
         "6"                                                              +
     ],                                                                   +
     "template": "[#6]-[#6]1-,=,:[#7]:[#7]-,=,:[#6](-[#9])-,=,:[#6]-,=,:1"+
 }                                                                        +
 
(1 row)

select mol_enumeratequery('COC |LN:1:1.3|'::mol);
  mol_enumeratequery  
----------------------
 {                   +
     "xqm_type": "2",+
     "mols": [       +
         "COC",      +
         "COOC",     +
         "COOOC"     +
     ]               +
 }                   +
 
(1 row)

select xqmol_to_tautomerquery(mol_enumeratequery('COC1=NNC=C1 |LN:1:1.3|'::mol));
                                  xqmol_to_tautomerquery                                   
-------------------------------------------------------------------------------------------
 {                                                                                        +
     "xqm_type": "4",                                                                     +
     "num_entries": "3",                                                                  +
     "tautomerQueries": [                                                                 +
         {                                                                                +
             "tautomers": [                                                               +
                 "COc1cc[nH]n1",                                                          +
                 "COc1ccn[nH]1"                                                           +
             ],                                                                           +
             "modifiedAtoms": [                                                           +
                 "3",                                                                     +
                 "5"                                                                      +
             ],                                                                           +
             "modifiedBonds": [                                                           +
                 "2",                                                                     +
                 "3",                                                                     +
                 "5",                                                                     +
                 "6"                                                                      +
             ],                                                                           +
             "template": "[#6]-[#8]-[#6]1-,=,:[#7]:[#7]-,=,:[#6]-,=,:[#6]-,=,:1"          +
         },                                                                               +
         {                                                                                +
             "tautomers": [                                                               +
                 "COOc1cc[nH]n1",                                                         +
                 "COOc1ccn[nH]1"                                                          +
             ],                                                                           +
             "modifiedAtoms": [                                                           +
                 "4",                                                                     +
                 "6"                                                                      +
             ],                                                                           +
             "modifiedBonds": [                                                           +
                 "3",                                                                     +
                 "4",                                                                     +
                 "6",                                                                     +
                 "7"                                                                      +
             ],                                                                           +
             "template": "[#6]-[#8]-[#8]-[#6]1-,=,:[#7]:[#7]-,=,:[#6]-,=,:[#6]-,=,:1"     +
         },                                                                               +
         {                                                                                +
             "tautomers": [                                                               +
                 "COOOc1cc[nH]n1",                                                        +
                 "COOOc1ccn[nH]1"                                                         +
             ],                                                                           +
             "modifiedAtoms": [                                                           +
                 "5",                                                                     +
                 "7"                                                                      +
             ],                                                                           +
             "modifiedBonds": [                                                           +
                 "4",                                                                     +
                 "5",                                                                     +
                 "7",                                                                     +
                 "8"                                                                      +
             ],                                                                           +
             "template": "[#6]-[#8]-[#8]-[#8]-[#6]1-,=,:[#7]:[#7]-,=,:[#6]-,=,:[#6]-,=,:1"+
         }                                                                                +
     ]                                                                                    +
 }                                                                                        +
 
(1 row)

-- substructure searching
select 'Cc1[nH]nc(F)c1'::mol @> mol_to_tautomerquery('Cc1n[nH]c(F)c1'::mol);
 ?column? 
----------
 t
(1 row)

select substruct('Cc1[nH]nc(F)c1'::mol,mol_to_tautomerquery('Cc1n[nH]c(F)c1'::mol));
 substruct 
-----------
 t
(1 row)

select substruct('Cc1[nH]nc(F)c1'::mol,mol_to_tautomerquery('Cc1n[nH]c(F)n1'::mol));
 substruct 
-----------
 f
(1 row)

select substruct('COC'::mol,'COC |LN:1:1.3|'::mol);
 substruct 
-----------
 t
(1 row)

select substruct('COC'::mol,mol_enumeratequery('COC |LN:1:1.3|'::mol));
 substruct 
-----------
 t
(1 row)

select substruct('COOC'::mol,'COC |LN:1:1.3|'::mol);
 substruct 
-----------
 f
(1 row)

select substruct('COOC'::mol,mol_enumeratequery('COC |LN:1:1.3|'::mol));
 substruct 
-----------
 t
(1 row)

select substruct('COOOC'::mol,mol_enumeratequery('COC |LN:1:1.3|'::mol));
 substruct 
-----------
 t
(1 row)

select substruct('COOOOC'::mol,mol_enumeratequery('COC |LN:1:1.3|'::mol));
 substruct 
-----------
 f
(1 row)

select 'COc1[nH]ncc1'@>xqmol_to_tautomerquery(mol_enumeratequery('COC1=NNC=C1 |LN:1:1.3|'::mol));
 ?column? 
----------
 t
(1 row)

select 'COc1[n][nH]cc1'@>xqmol_to_tautomerquery(mol_enumeratequery('COC1=NNC=C1 |LN:1:1.3|'::mol));
 ?column? 
----------
 t
(1 row)

select 'COOc1[nH]ncc1'@>xqmol_to_tautomerquery(mol_enumeratequery('COC1=NNC=C1 |LN:1:1.3|'::mol));
 ?column? 
----------
 t
(1 row)

select 'COOOc1[nH]ncc1'@>xqmol_to_tautomerquery(mol_enumeratequery('COC1=NNC=C1 |LN:1:1.3|'::mol));
 ?column? 
----------
 t
(1 row)

select 'COOOOc1[nH]ncc1'@>xqmol_to_tautomerquery(mol_enumeratequery('COC1=NNC=C1 |LN:1:1.3|'::mol));
 ?column? 
----------
 f
(1 row)

-- edge cases and error handling
select mol_to_tautomerquery('C1'::mol);
ERROR:  could not create molecule from SMILES 'C1'
LINE 1: select mol_to_tautomerquery('C1'::mol);
                                    ^
select mol_to_tautomerquery('c1cc1'::mol);
ERROR:  MolToTautomerQuery: Can't kekulize mol.  Unkekulized atoms: 0 1 2
select mol_enumeratequery('COC1=NNC=C1'::mol);
   mol_enumeratequery   
------------------------
 {                     +
     "xqm_type": "2",  +
     "mols": [         +
         "COc1cc[nH]n1"+
     ]                 +
 }                     +
 
(1 row)

select 'CCOC1=NNC=C1'::mol@>mol_enumeratequery('COC1=NNC=C1'::mol);
 ?column? 
----------
 t
(1 row)

select mol_to_tautomerquery('CCCC'::mol);
         mol_to_tautomerquery          
---------------------------------------
 {                                    +
     "xqm_type": "3",                 +
     "tautomers": [                   +
         "CCCC"                       +
     ],                               +
     "modifiedAtoms": "",             +
     "modifiedBonds": "",             +
     "template": "[#6]-[#6]-[#6]-[#6]"+
 }                                    +
 
(1 row)

select 'CCCCOC'::mol@>mol_to_tautomerquery('CCCC'::mol);
 ?column? 
----------
 t
(1 row)

